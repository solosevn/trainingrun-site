<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRSbench — Training Run</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { background:#0d1117; color:#c9d1d9; font-family:sans-serif; margin:0; padding:20px; }
    .container { max-width:1400px; margin:auto; }
    h1 { color:#58a6ff; }
    .chart { height:500px; background:#161b22; border-radius:8px; padding:10px; margin:20px 0; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:12px; border-bottom:1px solid #30363d; }
    th { background:#21262d; }
    .positive { color:#56d364; } .negative { color:#f85149; }
    button, select { background:#21262d; color:#c9d1d9; border:1px solid #30363d; padding:8px; margin:5px; cursor:pointer; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const TRSbench = () => {
      const [data, setData] = useState(null);
      const [range, setRange] = useState('ALL');

      useEffect(() => {
        fetch('trs-data.json?' + Date.now())
          .then(r => r.json())
          .then(d => {
            console.log("Data loaded:", d);
            setData(d);
          })
          .catch(e => console.error("Fetch error:", e));
      }, []);

      if (!data) return <div>Loading TRSbench data...</div>;

      const len = {ALL: data.dates.length, '1D':1, '1W':7, '2W':14, '1M':30}[range] || data.dates.length;
      const start = data.dates.length - len;

      const chartData = data.dates.slice(start).map((d, i) => {
        const entry = { date: d };
        data.models.forEach(m => entry[m.name] = m.scores[start + i] ?? null);
        return entry;
      });

      const Sparkline = ({ scores }) => {
        if (!scores || scores.length < 2) return null;
        const filtered = scores.filter(s => s !== null);
        if (filtered.length < 2) return null;
        const max = Math.max(...filtered);
        const min = Math.min(...filtered);
        const points = scores.map((s, i) => {
          if (s === null) return null;
          const x = (i / (scores.length - 1)) * 100;
          const y = 100 - ((s - min) / (max - min || 1)) * 100;
          return `${x},${y}`;
        }).filter(p => p).join(' ');
        return <svg width="80" height="30"><polyline points={points} fill="none" stroke="#58a6ff" strokeWidth="2"/></svg>;
      };

      return (
        <div className="container">
          <h1>TRSbench — Training Run</h1>
          <p>WEEK 7 Daily scores · Updated {data.dates[data.dates.length-1]}</p>
          <select value={range} onChange={e => setRange(e.target.value)}>
            <option value="1D">1 Day</option>
            <option value="1W">1 Week</option>
            <option value="2W">2 Weeks</option>
            <option value="1M">1 Month</option>
            <option value="ALL">All Time</option>
          </select>

          <div className="chart">
            {/* Basic SVG multi-line chart */}
            <svg width="100%" height="100%" viewBox="0 0 1000 400">
              <g stroke="#30363d" strokeWidth="1">
                <line x1="0" y1="0" x2="1000" y2="0" />
                <line x1="0" y1="400" x2="1000" y2="400" />
              </g>
              {/* Add lines for top 5 models */}
              {data.models.slice(0,5).map((m, idx) => {
                const points = m.scores.slice(start).map((s, i) => {
                  if (s === null) return null;
                  const x = (i / (len-1)) * 1000;
                  const y = 400 - ((s - 0) / 100) * 400; // assume scores 0-100
                  return `${x},${y}`;
                }).filter(p => p).join(' ');
                return <polyline key={idx} points={points} fill="none" stroke={['#58a6ff','#f78166','#85e043','#e34c26','#ea4aaa'][idx]} strokeWidth="2"/>;
              })}
            </svg>
          </div>

          <table>
            <thead>
              <tr><th>Rank</th><th>Model</th><th>Company</th><th>Score</th><th>Change</th><th>Spark</th></tr>
            </thead>
            <tbody>
              {data.models.map((m, i) => (
                <tr key={m.name}>
                  <td>{i+1}</td>
                  <td>{m.name}</td>
                  <td>{m.company || 'N/A'}</td>
                  <td>{m.scores[m.scores.length-1]?.toFixed(2) || 'N/A'}</td>
                  <td className={m.change > 0 ? 'positive' : m.change < 0 ? 'negative' : ''}>
                    {m.change > 0 ? '+' : ''}{(m.change || 0).toFixed(2)}
                  </td>
                  <td><Sparkline scores={m.scores} /></td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    };

    ReactDOM.render(<TRSbench />, document.getElementById('root'));
  </script>
</body>
</html>
