<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRSbench — Training Run</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { background:#0d1117; color:#c9d1d9; font-family:sans-serif; margin:0; padding:20px; }
    .container { max-width:1400px; margin:auto; }
    h1 { color:#58a6ff; }
    .chart { height:400px; background:#161b22; border-radius:8px; padding:10px; }
    .leaderboard { margin-top:20px; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:12px; text-align:left; border-bottom:1px solid #30363d; }
    th { background:#21262d; }
    .positive { color:#56d364; }
    .negative { color:#f85149; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const TRSbenchApp = () => {
      const [data, setData] = useState(null);
      const [error, setError] = useState(null);
      const [timeRange, setTimeRange] = useState('ALL');
      const [compareMode, setCompareMode] = useState(false);
      const [selectedModels, setSelectedModels] = useState([]);

      useEffect(() => {
        fetch('trs-data.json')
          .then(res => res.json())
          .then(json => {
            // Simple checksum verify (from bible)
            const canonical = JSON.stringify(json.models.map(m => m.scores), null, 0);
              .then(h => Array.from(new Uint8Array(h)).map(b => b.toString(16).padStart(2,'0')).join(''));
            hash.then(h => {
              setData(json);
            });
          })
      }, []);

      if (error) return <div style={{color:'red'}}>{error}</div>;
      if (!data) return <div>Loading...</div>;

      const filteredScores = data.models.map(m => ({
        ...m,
        scores: m.scores.slice(-getRangeLength(timeRange, data.dates.length))
      }));

      const getRangeLength = (range, total) => {
        if (range === '1D') return 1;
        if (range === '1W') return 7;
        if (range === '2W') return 14;
        if (range === '1M') return 30;
        return total;
      };

      // Sparkline mini-chart (simple SVG)
      const Sparkline = ({ scores }) => {
        if (!scores || scores.length < 2) return null;
        const max = Math.max(...scores.filter(s => s !== null));
        const min = Math.min(...scores.filter(s => s !== null));
        const points = scores.map((s,i) => {
          if (s === null) return null;
          const x = (i / (scores.length-1)) * 100;
          const y = 100 - ((s - min) / (max - min || 1)) * 100;
          return `${x},${y}`;
        }).filter(p => p).join(' ');
        return <svg width="80" height="30" viewBox="0 0 100 100"><polyline points={points} fill="none" stroke="#58a6ff" strokeWidth="2"/></svg>;
      };

      return (
        <div className="container">
          <h1>TRSbench — Training Run</h1>
          <p>WEEK 5 Daily scores · Updated {data.dates[data.dates.length-1]}</p>
          {error && <p style={{color:'orange'}}>{error}</p>}

          <div>
            <button onClick={() => setCompareMode(!compareMode)}>{compareMode ? 'Exit Compare' : 'Compare All'}</button>
            <select onChange={e => setTimeRange(e.target.value)}>
              <option>1D</option><option>1W</option><option>2W</option><option>1M</option><option>ALL</option>
            </select>
          </div>

          <div className="chart"> {/* Placeholder for full chart lib - add Recharts/Chart.js if needed */ }
            <p>Interactive Chart Area (Sparklines + Hover in full version)</p>
          </div>

          <div className="leaderboard">
            <table>
              <thead>
                <tr><th>Rank</th><th>Model</th><th>Company</th><th>TRS Score</th><th>Change</th><th>Sparkline</th><th>Pillars</th></tr>
              </thead>
              <tbody>
                {filteredScores.map((m, i) => (
                  <tr key={m.name}>
                    <td>{i+1}</td>
                    <td>{m.name}</td>
                    <td>{m.company}</td>
                    <td>{m.scores[m.scores.length-1]?.toFixed(2) || 'N/A'}</td>
                    <td className={m.change > 0 ? 'positive' : 'negative'}>{m.change > 0 ? '+' : ''}{m.change?.toFixed(2)}</td>
                    <td><Sparkline scores={m.scores} /></td>
                    <td>Pillars: Safety 21%, Reasoning 20%...</td> {/* Expand per bible */}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    };

    ReactDOM.render(<TRSbenchApp />, document.getElementById('root'));
  </script>
</body>
</html>
